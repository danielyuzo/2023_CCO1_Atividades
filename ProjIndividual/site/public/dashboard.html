<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/dashboard.css">
    <script src="./js/funcoes.js"></script>
    <title>Document</title>
</head>

<body>
    <svg height="600" width="200" class="svgLeft">
        <path d="M0 0 Q140 0 100 145 
        Q100 155 110 160 
        L108 165 
        Q65 160 75 240 
        Q100 360 140 320 
        L145 325 
        Q130 340 145 370 
        S230 580 0 580" stroke="darkturquoise" stroke-width="3" fill="none" />
    </svg> 
    <svg height="600" width="200" class="svgRight">
        <path d="M200 0 
        Q60 0 100 145 
        Q100 155 90 160 
        L92 165 
        Q135 160 125 240 
        Q100 360 60 320 
        L55 325 
        Q70 340 55 370 
        S-30 580 200 580" stroke="darkturquoise" stroke-width="3" fill="none" />
    </svg> 

    <!-- Header -->
    <div class="header" id="divHeader">
    </div>

    <!-- Corpo -->
    <div class="container">
        <div class="filtros">
            <div class="filtroCard">
                Métrica: 
                <select id="selMetrica" onchange="mudarMetrica()">
                    <option value="visualizacao">Visualizações</option>
                    <option value="comentario">Comentários</option>
                </select>
            </div>
            <div class="filtroCard">
                Agrupar por: 
                <select id="selGrupo" onchange="mudarAgrupamento()">
                    <option value="categoria">Categoria</option>
                    <option value="post">Post</option>
                    <option value="mes">Mês</option>
                    <option value="semana">Dia da Semana</option>
                </select>
            </div>
            <div class="filtroCard">
                Período: 
                <select id="selPeriodo" onchange="mudarPeriodo()">
                    <option value="total">Total</option>
                    <option value="ano">1 Ano</option>
                    <option value="mes">1 Mês</option>
                    <option value="semana">1 Semana</option>
                </select>
            </div>
        </div>

        <div class="graficos">
<div id="divMsg"></div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer" id="divFooter">
    </div>
</body>

</html>

<script>

    validarSessao(false);

    var metrica = 'visualizacao';
    var agrupamento = 'categoria';
    var periodo = 'total';

    function mudarMetrica() {
        metrica = selMetrica.value;
        atualizarGraficos();
    }  

    function mudarAgrupamento() {
        agrupamento = selGrupo.value;
        atualizarGraficos();
    }

    function mudarPeriodo() {
        periodo = selPeriodo.value;
        atualizarGraficos();
    }

    function atualizarGraficos() {
        fetch(`/dashboard/obterDados/${metrica}-${agrupamento}-${periodo}`)
            .then((response) => {
                if(response.ok) {
                    response.json().then((resposta) => {
                        var texto = '';
                        for (let i = 0; i < resposta.length; i++) {
                            texto += `${resposta[i].label} - ${resposta[i].dado}<br>`;
                        }
                        divMsg.innerHTML = texto;
                    })
                } else {
                    console.log(response);
                }
            }).catch((erro)=>{
                console.log(erro);
            })
    }

    printarHeader();
    printarFooter();

</script>